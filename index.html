<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>THE EX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial; background: #0f0f0f; color: #fff; text-align: center; }
    .container { max-width: 400px; margin: 30px auto; }
    input, button { width: 90%; padding: 10px; margin: 10px; border-radius: 6px; border: none; }
    button { background: #ffa500; color: #000; font-weight: bold; cursor: pointer; }
    .link { display: block; color: #aaa; margin-top: 10px; font-size: 14px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>THE EX</h2>
    <p>Введите ваш ID:</p>
    <input id="userId" type="text" placeholder="Ваш Telegram ID" />
    <p>Баланс: <b>0.00 BTC</b></p>

    <button onclick="openDeposit()">Пополнить баланс</button>
    <button onclick="openSend()">Отправить BTC</button>
    <button onclick="showHistory()">История</button>

    <div id="extra"></div>

    <a href="#" class="link">Тарифы</a>
    <a href="#" class="link">Где найти терминал?</a>
  </div>

  <script>
    const SHEETS_URL = "https://script.google.com/macros/s/AKfycbwKlARE_qAs6fOw2I1rDSWdj5D-V1h6A0t8kB1uaFLFD9uH8F1Rr02WKrH4cUnxw3MfUA/exec";

    const tg = window.Telegram.WebApp;
    tg.expand();

    function openDeposit() {
      document.getElementById('extra').innerHTML = `
        <p>Введите номер терминала:</p>
        <input id="terminal" type="text" placeholder="Номер терминала" />
        <button onclick="sendDeposit()">Отправить</button>
      `;
    }

    function openSend() {
      document.getElementById('extra').innerHTML = `
        <p>Введите адрес кошелька BTC:</p>
        <input id="wallet" type="text" placeholder="BTC адрес" />
        <p>Введите сумму BTC:</p>
        <input id="amount" type="number" placeholder="0.00" />
        <button onclick="sendBTC()">Отправить</button>
      `;
    }

    function showHistory() {
      document.getElementById('extra').innerHTML = `
        <h4>История заявок (демо)</h4>
        <p>Отправка BTC — 0.01 — 25.10.2025</p>
        <p>Пополнение — терминал 101 — 20.10.2025</p>
      `;
    }

    async function sendDeposit() {
      const terminal = document.getElementById("terminal").value;
      const telegramId = tg.initDataUnsafe?.user?.id || document.getElementById("userId").value;

      if (!terminal || !telegramId) return alert("Введите ID и номер терминала!");

      const data = {
        telegram_id: telegramId,
        operation: "Пополнение",
        data: `Номер терминала: ${terminal}`
      };

      await sendToSheets(data);
      alert("Заявка отправлена!");
    }

    async function sendBTC() {
      const wallet = document.getElementById("wallet").value;
      const amount = document.getElementById("amount").value;
      const telegramId = tg.initDataUnsafe?.user?.id || document.getElementById("userId").value;

      if (!wallet || !amount || !telegramId) return alert("Заполните все поля!");

      const data = {
        telegram_id: telegramId,
        operation: "Отправка",
        data: `Кошелек: ${wallet}, Сумма: ${amount} BTC`
      };

      await sendToSheets(data);
      alert("Заявка отправлена!");
    }

    async function sendToSheets(data) {
      try {
        await fetch(SHEETS_URL, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify(data)
        });
      } catch (e) {
        console.error(e);
      }
    }
  </script>
</body>
</html>
